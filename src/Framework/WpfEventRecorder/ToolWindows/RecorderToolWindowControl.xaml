<UserControl x:Class="WpfEventRecorder.ToolWindows.RecorderToolWindowControl"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:local="clr-namespace:WpfEventRecorder.ToolWindows"
             mc:Ignorable="d"
             d:DesignHeight="400" d:DesignWidth="600"
             Background="{DynamicResource VsBrush.Window}"
             Foreground="{DynamicResource VsBrush.WindowText}">

    <UserControl.Resources>
        <Style x:Key="HeaderStyle" TargetType="TextBlock">
            <Setter Property="FontWeight" Value="SemiBold"/>
            <Setter Property="Margin" Value="0,0,0,5"/>
        </Style>

        <Style x:Key="ToolbarButtonStyle" TargetType="Button">
            <Setter Property="Padding" Value="8,4"/>
            <Setter Property="Margin" Value="2"/>
            <Setter Property="MinWidth" Value="60"/>
        </Style>

        <Style x:Key="StatusIndicatorStyle" TargetType="Ellipse">
            <Setter Property="Width" Value="12"/>
            <Setter Property="Height" Value="12"/>
            <Setter Property="Margin" Value="5,0"/>
        </Style>
    </UserControl.Resources>

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="150"/>
        </Grid.RowDefinitions>

        <!-- Toolbar -->
        <Border Grid.Row="0" BorderThickness="0,0,0,1"
                BorderBrush="{DynamicResource VsBrush.PanelBorder}"
                Padding="5">
            <StackPanel Orientation="Horizontal">
                <Button x:Name="StartButton" Content="Start"
                        Style="{StaticResource ToolbarButtonStyle}"
                        Click="StartButton_Click"
                        ToolTip="Start recording (Ctrl+Alt+R)"/>
                <Button x:Name="StopButton" Content="Stop"
                        Style="{StaticResource ToolbarButtonStyle}"
                        Click="StopButton_Click"
                        IsEnabled="False"
                        ToolTip="Stop recording (Ctrl+Alt+S)"/>

                <Separator Margin="10,0"/>

                <Button x:Name="SaveButton" Content="Save"
                        Style="{StaticResource ToolbarButtonStyle}"
                        Click="SaveButton_Click"
                        IsEnabled="False"
                        ToolTip="Save recording to JSON file (Ctrl+Alt+E)"/>
                <Button x:Name="LoadButton" Content="Load"
                        Style="{StaticResource ToolbarButtonStyle}"
                        Click="LoadButton_Click"
                        ToolTip="Load recording from JSON file"/>
                <Button x:Name="SaveCsvButton" Content="CSV"
                        Style="{StaticResource ToolbarButtonStyle}"
                        Click="SaveCsvButton_Click"
                        IsEnabled="False"
                        ToolTip="Export selected events to CSV file"/>
                <Button x:Name="SaveExcelButton" Content="Excel"
                        Style="{StaticResource ToolbarButtonStyle}"
                        Click="SaveExcelButton_Click"
                        IsEnabled="False"
                        ToolTip="Export selected events to Excel file"/>
                <Button x:Name="ClearButton" Content="Clear"
                        Style="{StaticResource ToolbarButtonStyle}"
                        Click="ClearButton_Click"
                        IsEnabled="False"
                        ToolTip="Clear all recorded events"/>

                <Separator Margin="10,0"/>

                <Ellipse x:Name="StatusIndicator"
                         Style="{StaticResource StatusIndicatorStyle}"
                         Fill="Gray"
                         ToolTip="Recording status"/>
                <TextBlock x:Name="StatusText"
                           Text="Ready"
                           VerticalAlignment="Center"
                           Margin="5,0"/>

                <Separator Margin="10,0"/>

                <TextBlock Text="Events:" VerticalAlignment="Center" Margin="5,0"/>
                <TextBlock x:Name="EventCountText" Text="0"
                           VerticalAlignment="Center"
                           FontWeight="Bold"/>

                <Separator Margin="10,0"/>

                <TextBlock Text="Selected:" VerticalAlignment="Center" Margin="5,0"/>
                <TextBlock x:Name="SelectedCountText" Text="0"
                           VerticalAlignment="Center"
                           FontWeight="Bold"/>
                <Button x:Name="SelectAllButton" Content="All"
                        Style="{StaticResource ToolbarButtonStyle}"
                        Click="SelectAllButton_Click"
                        IsEnabled="False"
                        ToolTip="Select all events"
                        MinWidth="40"/>
                <Button x:Name="DeselectAllButton" Content="None"
                        Style="{StaticResource ToolbarButtonStyle}"
                        Click="DeselectAllButton_Click"
                        IsEnabled="False"
                        ToolTip="Deselect all events"
                        MinWidth="40"/>
            </StackPanel>
        </Border>

        <!-- Events List -->
        <ListView Grid.Row="1" x:Name="EventsList"
                  SelectionChanged="EventsList_SelectionChanged"
                  BorderThickness="0">
            <ListView.View>
                <GridView>
                    <GridViewColumn Width="30">
                        <GridViewColumn.Header>
                            <CheckBox x:Name="SelectAllCheckBox"
                                      Click="SelectAllCheckBox_Click"
                                      ToolTip="Select/Deselect All"
                                      IsChecked="True"/>
                        </GridViewColumn.Header>
                        <GridViewColumn.CellTemplate>
                            <DataTemplate>
                                <CheckBox IsChecked="{Binding IsSelectedForExport, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                          Click="CheckBox_Click"
                                          VerticalAlignment="Center"
                                          HorizontalAlignment="Center"/>
                            </DataTemplate>
                        </GridViewColumn.CellTemplate>
                    </GridViewColumn>
                    <GridViewColumn Header="Time" Width="80"
                                    DisplayMemberBinding="{Binding TimestampFormatted}"/>
                    <GridViewColumn Header="Type" Width="70"
                                    DisplayMemberBinding="{Binding TypeIcon}"/>
                    <GridViewColumn Header="Summary" Width="320"
                                    DisplayMemberBinding="{Binding Summary}"/>
                    <GridViewColumn Header="Duration" Width="70"
                                    DisplayMemberBinding="{Binding DurationMs, StringFormat={}{0}ms}"/>
                </GridView>
            </ListView.View>

            <ListView.ItemContainerStyle>
                <Style TargetType="ListViewItem">
                    <Style.Triggers>
                        <DataTrigger Binding="{Binding IsSuccess}" Value="False">
                            <Setter Property="Foreground" Value="Red"/>
                        </DataTrigger>
                        <DataTrigger Binding="{Binding IsApiEvent}" Value="True">
                            <Setter Property="FontStyle" Value="Italic"/>
                        </DataTrigger>
                    </Style.Triggers>
                </Style>
            </ListView.ItemContainerStyle>
        </ListView>

        <!-- Splitter -->
        <GridSplitter Grid.Row="2" Height="5" HorizontalAlignment="Stretch"
                      Background="{DynamicResource VsBrush.PanelBorder}"/>

        <!-- Details Panel -->
        <Border Grid.Row="3" BorderThickness="0,1,0,0"
                BorderBrush="{DynamicResource VsBrush.PanelBorder}">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="*"/>
                </Grid.ColumnDefinitions>

                <!-- Details -->
                <ScrollViewer Grid.Column="0" Margin="5">
                    <StackPanel>
                        <TextBlock Text="Event Details" Style="{StaticResource HeaderStyle}"/>
                        <TextBox x:Name="DetailsTextBox"
                                 IsReadOnly="True"
                                 TextWrapping="Wrap"
                                 AcceptsReturn="True"
                                 VerticalScrollBarVisibility="Auto"
                                 BorderThickness="0"
                                 Background="Transparent"
                                 FontFamily="Consolas"
                                 FontSize="11"/>
                    </StackPanel>
                </ScrollViewer>

                <!-- Body Content -->
                <ScrollViewer Grid.Column="1" Margin="5">
                    <StackPanel>
                        <TextBlock Text="Request/Response Body" Style="{StaticResource HeaderStyle}"/>
                        <TextBox x:Name="BodyTextBox"
                                 IsReadOnly="True"
                                 TextWrapping="Wrap"
                                 AcceptsReturn="True"
                                 VerticalScrollBarVisibility="Auto"
                                 BorderThickness="0"
                                 Background="Transparent"
                                 FontFamily="Consolas"
                                 FontSize="11"/>
                    </StackPanel>
                </ScrollViewer>
            </Grid>
        </Border>
    </Grid>
</UserControl>
